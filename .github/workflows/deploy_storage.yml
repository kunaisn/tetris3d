name: Deploy to GCP Storage
run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: GCPの準備
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_KEY }}
        
      - name: GCPサービスアカウントJSONキーを生成
        run: echo "${{ secrets.GCP_KEY_BASE64 }}" | base64 -d > tmp.json
        
      - name: GCPに認証を通す
        run: gcloud auth activate-service-account --key-file=tmp.json
        
      - name: アップロード
        run: gsutil -m rsync -r -d ./game/ ${{ secrets.GCS_BUCKET_PATH }}
        
      - name: JSONキーを削除
        run : rm -f tmp.json
