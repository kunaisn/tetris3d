name: Deploy to GCP Storage
run-name: ${{ github.actor }} is testing out GitHub Actions ğŸš€
on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: GCPã®æº–å‚™
        uses: google-github-actions/auth@v1
        with:
          credentials_json: ${{ secrets.GCP_KEY }}
        
      - name: GCPã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰
        run: echo "${{ secrets.GCP_KEY_BASE64 }}" | base64 -d > temp-sa.json
        
      - name: GCPã«èªè¨¼ã‚’é€šã™
        run: gcloud auth activate-service-account --key-file=temp-sa.json
        
      - name: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        run: gsutil -m rsync -r -d ${{ env.JSON_DIR }} ${{ secrets.GCS_BUCKET_PATH }}/${{ env.JSON_DIR }}
        
      - name: ä¸€æ¬¡ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
        run : rm -f temp-sa.json
